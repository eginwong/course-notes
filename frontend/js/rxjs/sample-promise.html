<html>

<body>
    <h1>Keyword Search Promises</h1>
    <div>Results returned: <span id="query-total"></span></div>
    <input type="text" style="width: 100%" id="rick-and-morty-query" placeholder="search for a Rick and Morty title">

    <h2>Results</h2>
    <div id="results">Search me</div>

    <script>
        function keyupFunction() {
            const query = document.getElementById("rick-and-morty-query").value;
            const url = 'https://rickandmortyapi.com/api/episode/?name=' + query + '&status=alive';

            fetch(url).then(data => data.json())
                .then(res => displayResults(res))
                .catch(error => displayNoResults());
        }

        function displayResults(res) {
            document.getElementById("results").innerHTML = createTableRepresentation(res);
            document.getElementById("query-total").innerText = res.info.count;
        }

        function createTableRepresentation(res) {
            const header = '<table border="1"><tbody><tr><td>Name</td><td>Episode</td></tr>';
            const footer = '</tbody></table>';

            return header +
                res.results.map(episode => '<tr><td>' + episode.name + '</td><td>' + episode.episode +
                    '</td></tr>').join('') + footer;
        }

        function displayNoResults() {
            document.getElementById("query-total").innerText = 0;
            document.getElementById("results").innerHTML = '<h2>No results found</h2>';
        }

        document.getElementById("rick-and-morty-query").addEventListener('keyup', keyupFunction);
    </script>
</body>

</html>